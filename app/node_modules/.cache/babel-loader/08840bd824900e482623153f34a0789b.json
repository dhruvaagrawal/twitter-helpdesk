{"ast":null,"code":"module.exports = setUser;\n\nvar assert = require('assert');\n\nvar path = require('path');\n\nvar fs = require('fs');\n\nvar mkdirp = require('gentle-fs').mkdir;\n\nfunction setUser(cb) {\n  var defaultConf = this.root;\n  assert(defaultConf !== Object.prototype); // If global, leave it as-is.\n  // If not global, then set the user to the owner of the prefix folder.\n  // Just set the default, so it can be overridden.\n\n  if (this.get('global')) return cb();\n\n  if (process.env.SUDO_UID) {\n    defaultConf.user = +process.env.SUDO_UID;\n    return cb();\n  }\n\n  var prefix = path.resolve(this.get('prefix'));\n  mkdirp(prefix, function (er) {\n    if (er) return cb(er);\n    fs.stat(prefix, function (er, st) {\n      defaultConf.user = st && st.uid;\n      return cb(er);\n    });\n  });\n}","map":null,"metadata":{},"sourceType":"script"}